<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6fb;
  padding: 20px;
}

h1, h2 {
  color: #333;
}

table {
  border-collapse: collapse;
  width: 100%;
  background: white;
}

th, td {
  padding: 10px;
  border: 1px solid #ddd;
}

th {
  background: #2c3e50;
  color: white;
}

tr:nth-child(even) {
  background: #f2f2f2;
}

button {
  padding: 6px 10px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

button:hover {
  opacity: 0.8;
}

form {
  display: inline;
}

a {
  text-decoration: none;
  color: #3498db;
  font-weight: bold;
}
</style>

<h1>Admin Panel</h1>

<h2>Statistics</h2>

<ul>
  <li>Total users: {{ total_users }}</li>
  <li>With Telegram: {{ with_tg }}</li>
  <li>Without Telegram: {{ without_tg }}</li>
</ul>

<a href="/admin/logs">View logs</a>
<hr>

<hr>

<form method="get" action="/admin">
    <input type="text" name="q" placeholder="Search by email" value="{{ q }}">
    <button>Search</button>
</form>

<form method="get" action="/admin">
    <input type="hidden" name="q" value="{{ q }}">

    <select name="tg">
        <option value="">All</option>
        <option value="yes" {% if tg=="yes" %}selected{% endif %}>With Telegram</option>
        <option value="no" {% if tg=="no" %}selected{% endif %}>No Telegram</option>
    </select>

    <button>Filter</button>
</form>

<br>

<table border="1">
<tr>
  <th>ID</th>
  <th>Email</th>
  <th>Token</th>
  <th>Telegram ID</th>
  <th>Actions</th>
</tr>

{% for u in users %}
<tr>
  <td>{{ u.id }}</td>
  <td>{{ u.email }}</td>
  <td>{{ u.api_token }}</td>
  <td>{{ u.tg_id }}</td>

  <td>
    <form action="/admin/unlink/{{u.id}}" method="post" style="display:inline;">
     <button onclick="return confirm('Unlink Telegram for {{u.email}}?')">
        Unlink TG
      </button>
    </form>

    <form action="/admin/reset-token/{{u.id}}" method="post" style="display:inline;">
      <button onclick="return confirm('Reset token for {{u.email}}?')">
        Reset Token
      </button>
    </form>

    <form action="/admin/delete/{{u.id}}" method="post" style="display:inline;">
      <button onclick="return confirm('DELETE user {{u.email}}? This cannot be undone!')">
        Delete
      </button>
    </form>

  </td>
</tr>
{% endfor %}
</table>

<br>
<a href="/dashboard">Back</a>
