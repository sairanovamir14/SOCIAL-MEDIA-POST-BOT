<h1>Admin Panel</h1>

<h2>Statistics</h2>

<ul>
  <li>Total users: {{ total_users }}</li>
  <li>With Telegram: {{ with_tg }}</li>
  <li>Without Telegram: {{ without_tg }}</li>
</ul>

<a href="/admin/logs">View logs</a>
<hr>

<hr>

<form method="get" action="/admin">
    <input type="text" name="q" placeholder="Search by email" value="{{ q }}">
    <button>Search</button>
</form>

<form method="get" action="/admin">
    <input type="hidden" name="q" value="{{ q }}">

    <select name="tg">
        <option value="">All</option>
        <option value="yes" {% if tg=="yes" %}selected{% endif %}>With Telegram</option>
        <option value="no" {% if tg=="no" %}selected{% endif %}>No Telegram</option>
    </select>

    <button>Filter</button>
</form>

<br>

<table border="1">
<tr>
  <th>ID</th>
  <th>Email</th>
  <th>Token</th>
  <th>Telegram ID</th>
  <th>Actions</th>
</tr>

{% for u in users %}
<tr>
  <td>{{ u.id }}</td>
  <td>{{ u.email }}</td>
  <td>{{ u.api_token }}</td>
  <td>{{ u.tg_id }}</td>

  <td>
    <form action="/admin/unlink/{{u.id}}" method="post" style="display:inline;">
      <button>Unlink TG</button>
    </form>

    <form action="/admin/reset-token/{{u.id}}" method="post" style="display:inline;">
      <button>Reset Token</button>
    </form>

    <form action="/admin/delete/{{u.id}}" method="post" style="display:inline;">
      <button onclick="return confirm('Delete user?')">Delete</button>
    </form>
  </td>
</tr>
{% endfor %}
</table>

<br>
<a href="/dashboard">Back</a>
